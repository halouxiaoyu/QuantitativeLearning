# AI量化交易学习平台

一个专为初学者设计的AI量化交易学习平台，采用分层架构设计，支持完整的量化交易流程：从数据获取到模型训练，再到未来预测。

## 🚀 项目特色

- **分层架构设计**：清晰的数据层、特征层、模型层、预测层分离
- **简化工作流程**：数据获取 → 特征工程 → 模型训练 → 未来预测（4步流程）
- **Web可视化界面**：直观的操作界面，实时进度显示
- **单股票分析**：支持输入单个股票代码进行深度分析
- **智能代码识别**：支持纯数字输入，自动识别交易所和板块（主板、创业板、科创板）
- **机器学习集成**：集成随机森林、XGBoost等高性能算法
- **技术指标丰富**：包含移动平均、RSI、MACD等常用技术指标
- **特征优化**：智能特征选择，23个核心特征，减少噪音提高性能
- **标签优化**：使用0.0%涨跌幅阈值，预测第二天涨跌，实现最佳数据平衡
- **灵活预测**：支持2-5天未来预测，默认2天，使用滚动预测方法
- **智能股票选择**：自动检测可预测股票，显示完整状态信息
- **数据安全**：已修复数据泄露问题，确保模型训练的真实性

## 🏗️ 系统架构

```
AI量化交易学习平台
├── 数据层 (Data Layer)
│   ├── 数据获取与清洗 (DataManager)
│   └── 本地数据存储
├── 特征层 (Feature Layer)
│   ├── 技术指标构建 (FeatureEngineer) - 23个核心特征
│   ├── 特征选择优化 (FeatureSelector)
│   └── 特征数据管理
├── 模型层 (Model Layer)
│   ├── 模型训练与保存 (ModelTrainer) - 随机森林/XGBoost
│   └── 交叉验证与评估
├── 预测层 (Prediction Layer)
│   └── 未来预测 (FuturePredictor) - 支持2-5天滚动预测
└── Web界面层
    ├── Flask后端API
    └── 响应式前端界面
```

## 📋 功能模块

### 1. 数据获取与清洗
- 支持多数据源：akshare、baostock
- 自动数据清洗和标准化
- 本地数据存储管理
- 数据状态监控
- **智能股票代码识别**：支持纯数字输入，自动识别交易所和板块
- **新增支持**：创业板301开头股票（如：301316慧博云通）

### 2. 特征工程 (已优化)
- **核心特征**：23个最重要的技术指标
- 技术指标构建：
  - 移动平均线 (MA5, MA10, MA20)
  - 价格比率 (MA5_ratio, MA10_ratio, MA20_ratio)
  - 指数移动平均线 (EMA12, EMA26)
  - MACD指标 (MACD_dif, MACD_dea)
  - 成交量指标 (Volume_MA5, Volume_ratio, Volume_price_trend)
  - 布林带 (BB_upper, BB_lower, BB_position)
  - 价格波动 (High_low_ratio, Volatility_10)
  - 趋势指标 (Trend_5, Price_change_2)
  - 超买超卖 (RSI14, Price_channel_position)
- **特征优化**：23个核心特征，减少噪音，提高性能
- **标签阈值优化**：默认使用0.0%阈值，实现最佳数据平衡
- 特征数据持久化
- 特征质量检查

### 3. 特征选择与优化 (新增)
- **智能特征选择**：基于特征重要性的自动选择
- **特征数量优化**：支持8、10、12、15、18、23个特征的选择（推荐23个）
- **性能对比**：不同特征数量的性能评估
- **最佳实践**：推荐23个特征的最佳配置

### 4. 模型训练与保存 (已优化)
- **算法选择**：随机森林、XGBoost
- **标签优化**：0.0%涨跌幅阈值，预测第二天涨跌，实现最佳数据平衡
- 时间序列数据分割
- 交叉验证评估
- 模型性能指标
- 模型持久化存储

### 5. 未来预测 (重大改进)
- **灵活预测天数**：支持2-5天预测，默认2天
- **滚动预测方法**：基于前一天预测结果预测下一天
- **智能特征调整**：根据预测结果动态调整技术指标
- **交易信号生成**：BUY/SELL/HOLD信号，带置信度评估
- **预测结果保存**：自动保存到CSV文件
- **股票状态检测**：自动检测哪些股票可以预测
- **智能股票选择**：下拉菜单显示可预测股票

## 🛠️ 技术栈

### 后端
- **Python 3.8+**：核心编程语言
- **Flask**：Web框架
- **pandas**：数据处理
- **numpy**：数值计算
- **scikit-learn**：机器学习 (随机森林)
- **XGBoost**：梯度提升算法
- **joblib**：模型持久化

### 前端
- **HTML5/CSS3**：页面结构
- **JavaScript (ES6+)**：交互逻辑
- **Bootstrap 5**：UI框架
- **Chart.js**：图表可视化

### 数据源
- **akshare**：开源金融数据接口
- **baostock**：证券宝数据接口

## 🎯 核心优化成果

### 特征优化
- **特征数量**：23个核心技术指标
- **性能提升**：减少噪音，提高模型泛化能力
- **特征选择方法**：随机森林重要性、F检验、互信息

### 标签优化
- **原始标签**：简单涨跌判断
- **优化后标签**：0.0%涨跌幅阈值，预测第二天涨跌
- **数据平衡**：实现最佳的数据分布平衡
- **性能提升**：修复数据泄露后，模型表现更真实

### 算法优化
- **选择**：随机森林（抗过拟合）、XGBoost（高性能）
- **推荐**：随机森林作为默认算法

### 预测系统优化
- **预测天数**：支持2-5天灵活预测
- **预测方法**：滚动预测，每天基于前一天结果
- **特征动态调整**：根据预测结果智能调整技术指标
- **股票状态检测**：自动识别可预测股票

## 📦 安装部署

### 环境要求
- Python 3.8+
- pip 包管理器
- 现代浏览器 (Chrome, Firefox, Safari, Edge)

### 安装步骤

1. **克隆项目**
```bash
git clone https://github.com/halouxiaoyu/QuantitativeLearning.git
```

2. **安装依赖**
```bash
pip install -r requirements.txt
```

3. **启动服务**
```bash
python web_app.py
```

4. **访问平台**
打开浏览器访问：`http://localhost:5002`

## 📖 使用指南

### 快速开始

1. **数据获取**
   - 直接输入股票代码（如：600000、000001、301316）
   - 系统自动识别交易所和板块
   - 设置时间范围（建议2020-2025）
   - 点击"开始下载"

2. **特征构建**
   - 系统自动构建23个核心特征
   - **可配置标签阈值**：支持0.0%-10.0%涨跌幅阈值设置
   - 默认使用0.0%阈值，可根据市场情况调整
   - 包含技术指标和标签生成
   - 点击"开始构建特征"

3. **模型训练**
   - 选择算法：随机森林（推荐）或XGBoost
   - 设置交叉验证折数（推荐5折）
   - 点击"开始训练模型"

4. **未来预测**
   - 选择可预测的股票（系统自动检测）
   - 设置预测天数（2-5天，默认2天）
   - 设置置信度阈值（建议0.6-0.7）
   - 点击"开始未来预测"

### 工作流程

```
数据获取 → 特征工程(23个特征) → 模型训练(随机森林/XGBoost) → 未来预测(2-5天)
    ↓              ↓                    ↓              ↓
  原始数据 → 核心技术指标+标签 → 高性能模型 → 滚动预测+交易信号
```

## 🔧 配置说明

### 默认时间配置
- **训练时间**：2021-01-01 到 2024-12-31
- **验证时间**：2025-01-01 到 2025-12-31
- **测试比例**：训练数据的20%用于内部测试

### 模型参数
- **算法**：随机森林（推荐）、XGBoost
- **交叉验证**：5折交叉验证
- **随机种子**：42（可配置）

### 特征配置
- **特征数量**：23个核心特征
- **标签阈值**：可配置涨跌幅阈值 (默认0.0%，支持0.0%-10.0%范围)
- **阈值配置**：Web界面支持实时调整，无需修改代码
- **预测周期**：第二天（支持每日交易决策）
- **特征类型**：技术指标 + 价格比率 + 成交量指标 + 超买超卖指标

### 预测配置
- **预测天数**：2-5天（默认2天）
- **预测方法**：滚动预测，基于前一天结果
- **置信度阈值**：0.6-0.7（建议值）
- **特征调整**：智能动态调整技术指标

## 📊 测试覆盖

项目包含完整的测试框架：
- **单元测试**：各模块独立功能测试
- **集成测试**：模块间协作测试
- **功能测试**：核心功能验证测试
- **特征选择测试**：特征优化功能测试

运行测试：
```bash
# 运行所有测试
python tests/run_tests.py

# 运行特定测试
python -m pytest tests/unit/ -v
python -m pytest tests/integration/ -v

# 生成覆盖率报告
python -m pytest --cov=modules --cov-report=html tests/
```

## 🔍 数据泄露问题修复

### 问题描述
在v2.0.0版本中，我们发现了一个严重的数据泄露问题：
- **现象**：模型在训练集和测试集上都达到100%准确率
- **原因**：特征中包含了未来信息（明天的价格、涨跌幅、标签）
- **影响**：模型"作弊"，直接看到答案，无法真实预测

### 修复过程
1. **问题定位**：发现`price_next_day`、`pct_change_next_day`、`label`被包含在特征中
2. **代码修复**：在`ModelTrainer`中排除所有标签相关列
3. **验证结果**：修复后模型表现更真实，符合预期

### 修复前后对比
| 指标 | 修复前 | 修复后 |
|------|--------|--------|
| **特征维度** | 21列（包含未来信息） | 23列（纯技术指标） |
| **交叉验证准确率** | 100% ± 0.0% | 66.0% ± 11.3% |
| **训练集准确率** | 100% | 74.5% |
| **测试集准确率** | 100% | 70.1% |
| **模型真实性** | ❌ 虚假（数据泄露） | ✅ 真实（无数据泄露） |

## 🚨 注意事项

1. **数据质量**：确保数据源稳定，数据质量良好
2. **模型风险**：机器学习模型存在过拟合风险，建议定期重新训练
3. **预测风险**：未来预测结果仅供参考，不代表实际表现
4. **资金管理**：实际交易请做好风险控制和资金管理
5. **特征选择**：23个特征已经过优化，不建议随意增减
6. **标签阈值**：可配置阈值 (默认0.0%)，支持0.0%-10.0%范围，可根据市场情况灵活调整
7. **预测天数**：建议使用2-3天预测，天数越多误差累积越大
8. **数据泄露防护**：已修复特征中包含未来信息的问题，确保模型训练的真实性
9. **股票代码输入**：支持纯数字输入，系统自动识别交易所和板块
10. **股票状态检测**：系统会自动检测哪些股票可以预测，避免无效操作

## 🤝 贡献指南

欢迎提交Issue和Pull Request！

### 贡献流程
1. Fork 项目
2. 创建特性分支 (`git checkout -b feature/AmazingFeature`)
3. 提交更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 开启 Pull Request

## 📄 许可证

本项目采用 MIT 许可证 - 查看 [LICENSE](LICENSE) 文件了解详情

## 📞 联系方式

- 项目主页：[GitHub Repository](https://github.com/halouxiaoyu/QuantitativeLearning)
- 问题反馈：[Issues](https://github.com/halouxiaoyu/QuantitativeLearning/issues)

## 🙏 致谢

感谢以下开源项目的支持：
- [akshare](https://github.com/akfamily/akshare) - 开源金融数据接口
- [baostock](http://baostock.com/baostock/index.html) - 证券宝数据接口
- [scikit-learn](https://scikit-learn.org/) - 机器学习库
- [XGBoost](https://xgboost.readthedocs.io/) - 梯度提升算法
- [Flask](https://flask.palletsprojects.com/) - Web框架

---

⭐ 如果这个项目对你有帮助，请给它一个星标！

## 📈 更新日志

### v3.0.0 (2025-08-22) - 重大版本更新
- 🎉 **工作流程简化**：从6步流程简化为4步流程，移除回测分析和历史验证
- ✨ **灵活未来预测**：支持2-5天预测，默认2天，使用滚动预测方法
- ✨ **智能股票选择**：自动检测可预测股票，下拉菜单显示状态信息
- ✨ **滚动预测算法**：基于前一天预测结果预测下一天，更科学
- ✨ **特征动态调整**：根据预测结果智能调整技术指标
- ✨ **标签阈值优化**：默认使用0.0%阈值，实现最佳数据平衡
- 🐛 **预测逻辑修复**：修复概率、置信度、预测标签不一致的问题
- 🗑️ **模块清理**：移除BacktestAnalyzer和HistoricalPredictor模块
- 📱 **界面优化**：简化Web界面，专注核心功能

### v2.3.0 (2025-08-22)
- ✨ **智能股票代码识别**：支持纯数字输入，自动识别交易所和板块
- ✨ **创业板301支持**：新增对301开头股票的支持（如：301316慧博云通）
- ✨ **用户界面优化**：简化股票代码输入，无需记忆交易所前缀
- ✨ **多股票测试验证**：支持多只股票测试，验证模型泛化能力
- 📊 **最新测试结果**：科达利(002850)随机森林70.1%，XGBoost67.5%
- 🐛 **验证逻辑修复**：修复股票代码验证中的创业板识别问题

### v2.2.0 (2025-08-22)
- ✨ **特征数量优化**：从18个特征增加到23个特征，提高模型预测能力
- ✨ **标签阈值优化**：从1%阈值调整到3%阈值，改善数据平衡性
- ✨ **涨停预测改善**：23个特征能更好地捕捉涨停前的市场信号
- 📊 **性能验证**：新模型训练集77.5%，测试集72.7%，数据平衡性大幅改善

### v2.1.0 (2025-08-22)
- ✨ **预测周期优化**：从5天后改为第二天，支持每日交易决策
- ✨ **实用价值提升**：第二天预测比5天预测更实用，提高资金周转效率
- ✨ **回测功能完善**：确保特征文件包含OHLCV数据，支持完整回测
- 🐛 **数据泄露修复**：修复特征中包含未来信息的问题，模型表现更真实
- 📊 **性能验证**：修复后模型训练集93.9%，测试集54.1%，符合预期

### v2.0.0 (2025-08-21)
- ✨ **重大优化**：特征数量优化到18个核心特征
- ✨ **标签优化**：使用3.0%涨跌幅阈值，实现合理数据平衡
- ✨ **算法优化**：移除逻辑回归，专注随机森林和XGBoost
- ✨ **新增功能**：特征选择器，支持不同特征数量的性能对比
- ✨ **界面优化**：简化Web界面，专注单股票分析
- 🐛 **问题修复**：修复过拟合问题，提高模型泛化能力

### v1.0.0 (2025-08-20)
- 🎉 **初始版本**：完整的AI量化交易学习平台
- ��️ **基础架构**：分层架构设计，模块化开发
- 📊 **核心功能**：数据获取、特征工程、模型训练、回测分析
- 🌐 **Web界面**：Flask后端 + Bootstrap前端
- 🧪 **测试框架**：完整的单元测试和集成测试
