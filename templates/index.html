<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI量化交易学习平台</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    <link href="/static/css/style.css" rel="stylesheet">
</head>
<body>
    <div class="container-fluid">
        <!-- 标题区域 -->
        <div class="row bg-primary text-white py-4">
            <div class="col-12 text-center">
                <h1><i class="bi bi-graph-up"></i> AI量化交易学习平台</h1>
                <p class="lead mb-0">专业的分层架构，适合初学者学习的量化交易平台</p>
                <div class="mt-3">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="text-center">
                                <i class="bi bi-download fs-2"></i>
                                <p class="mb-0">数据获取</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center">
                                <i class="bi bi-gear fs-2"></i>
                                <p class="mb-0">特征工程</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center">
                                <i class="bi bi-cpu fs-2"></i>
                                <p class="mb-0">模型训练</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center">
                                <i class="bi bi-graph-up fs-2"></i>
                                <p class="mb-0">策略回测</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 工作流程指示器 -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="progress-section text-center">
                    <h3>🚀 工作流程</h3>
                    <p class="text-muted mb-3">按照以下步骤依次执行，每个步骤都依赖前一步骤的完成</p>
                    <div class="row">
                        <div class="col-md-3">
                            <div class="workflow-step active" id="step1">
                                <h5><i class="bi bi-download"></i></h5>
                                <p>数据获取</p>
                                <small class="text-muted">下载股票历史数据</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="workflow-step" id="step2">
                                <h5><i class="bi bi-gear"></i></h5>
                                <p>特征工程</p>
                                <small class="text-muted">构建技术指标</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="workflow-step" id="step3">
                                <h5><i class="bi bi-cpu"></i></h5>
                                <p>模型训练</p>
                                <small class="text-muted">训练ML模型</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="workflow-step" id="step4">
                                <h5><i class="bi bi-lightning"></i></h5>
                                <p>未来预测</p>
                                <small class="text-muted">预测未来5天涨跌</small>
                            </div>
                        </div>
                        
                    </div>
                </div>
            </div>
        </div>

        <!-- 第一步：数据获取与清洗 -->
        <div class="module-section" id="dataModule">
            <h3><i class="bi bi-download text-primary"></i> 第一步：单个股票数据获取与清洗</h3>
            <p class="text-muted">输入股票代码，从多个数据源下载数据，进行清洗和预处理，保存到本地文件</p>
            
            <div class="alert alert-info">
                <h6><i class="bi bi-info-circle"></i> 模块说明：</h6>
                <ul class="mb-0">
                    <li><strong>数据源</strong>：支持akshare（数据较新）和baostock（稳定可靠）两个数据源</li>
                    <li><strong>数据清洗</strong>：自动处理缺失值、异常值，确保数据质量</li>
                    <li><strong>数据格式</strong>：包含开盘价、收盘价、最高价、最低价、成交量等OHLCV数据</li>
                    <li><strong>时间范围</strong>：建议下载2021-2025年数据，其中2021-2024年用于训练，2025年用于验证</li>
                </ul>
            </div>
            
            <div class="row">
                <div class="col-md-6">
                    <h5>单个股票分析</h5>
                                            <div class="mb-3">
                            <label for="singleStockCode" class="form-label">股票代码</label>
                            <div class="input-group">
                                <input type="text" class="form-control" id="singleStockCode" 
                                       placeholder="直接输入股票代码，如：600000、000001、002850等" 
                                       maxlength="10">
                                <button class="btn btn-outline-secondary" type="button" onclick="validateStockCode()">
                                    <i class="bi bi-check-circle"></i> 验证
                                </button>
                            </div>
                            <div id="stockCodeValidation" class="mt-2"></div>
                            <small class="text-muted">
                                <strong>💡 简化输入:</strong><br>
                                • 直接输入纯数字代码即可，如：600000、000001、002850<br>
                                • 系统会自动识别交易所（上海、深圳、创业板）<br>
                                • 也支持带前缀格式：sh600000、sz000001等
                            </small>
                        </div>
                    
                    <div class="mb-3">
                        <h5>选择数据源</h5>
                        <select class="form-select mb-3" id="dataSource">
                            <option value="auto">🔄 自动选择 (智能降级)</option>
                            <option value="baostock">🏦 baostock (稳定可靠)</option>
                            <option value="akshare">📊 akshare (数据较新)</option>
                        </select>
                        <div class="data-source-info mt-2">
                            <small class="text-muted d-block">
                                <strong>🔄 自动选择:</strong> 优先使用 akshare，失败时自动降级到 baostock
                            </small>
                            <small class="text-muted d-block">
                                <strong>🏦 baostock:</strong> 稳定可靠，适合单个股票分析
                            </small>
                            <small class="text-muted d-block">
                                <strong>📊 akshare:</strong> 数据较新，包含更多技术指标，适合专业分析
                            </small>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <h5>选择时间范围</h5>
                        <div class="row">
                            <div class="col-6">
                                <label for="downloadStartDate" class="form-label">开始日期</label>
                                <input type="date" class="form-control" id="downloadStartDate" value="2021-01-01">
                                <small class="text-muted">数据下载开始日期</small>
                            </div>
                            <div class="col-6">
                                <label for="downloadEndDate" class="form-label">结束日期</label>
                                <input type="date" class="form-control" id="downloadEndDate" value="2025-12-31">
                                <small class="text-muted">数据下载结束日期</small>
                            </div>
                        </div>
                        <div class="alert alert-info mt-2">
                            <small>
                                <strong>💡 建议:</strong> 建议下载2021-2025年的数据，其中2021-2024年用于训练，2025年用于验证。单个股票分析建议选择较长时间范围以获得更好的模型效果。
                            </small>
                        </div>
                    </div>
                    
                    <button class="btn btn-primary btn-lg" onclick="downloadSingleStock()" id="downloadBtn">
                        <i class="bi bi-download"></i> 开始下载
                    </button>
                    <small class="text-muted d-block mt-2">点击开始下载单个股票数据</small>
                </div>
                
                <div class="col-md-6">
                    <h5>下载状态</h5>
                    <div class="alert alert-info mb-3">
                        <small>
                            <strong>📊 单个股票分析模式:</strong> 输入股票代码后，系统将自动下载该股票的历史数据，包括开盘价、收盘价、最高价、最低价和成交量等信息。
                        </small>
                    </div>
                    <div id="downloadStatus">
                        <p class="text-muted">等待开始下载</p>
                    </div>
                    
                    <h5 class="mt-4">下载进度</h5>
                    <div id="downloadProgress" style="display: none;">
                        <div class="progress-indicator">
                            <div class="progress-bar" id="downloadProgressBar" style="width: 0%"></div>
                        </div>
                        <p class="mt-2" id="downloadStatusText">准备下载...</p>
                    </div>
                    
                    <div id="downloadOverview" class="mt-3">
                        <span class="badge bg-secondary">等待下载</span>
                    </div>
                    
                    <div id="dataOverview" class="mt-3">
                        <span class="badge bg-secondary">等待数据</span>
                    </div>
                </div>
            </div>
            
            <!-- 数据状态 -->
            <div id="dataStatus" class="mt-4">
                <h5>数据状态</h5>
                <div class="row">
                    <!-- 状态将在这里动态显示 -->
                </div>
            </div>
        </div>

        <!-- 清空所有数据 -->
        <div class="clear-data-section">
            <h3><i class="bi bi-trash text-warning"></i> 清空所有数据</h3>
            <p class="text-muted">⚠️ 危险操作：此功能将删除所有已下载的数据、构建的特征、训练的模型、回测结果和预测结果</p>
            
            <div class="row">
                <div class="col-md-8">
                    <div class="alert alert-warning">
                        <h6><i class="bi bi-exclamation-triangle"></i> 清空前请确认：</h6>
                        <ul class="mb-0">
                            <li>所有股票数据将被删除</li>
                            <li>所有特征数据将被删除</li>
                            <li>所有训练好的模型将被删除</li>
                            <li>所有回测结果将被删除</li>
                            <li>所有预测结果将被删除</li>
                        </ul>
                    </div>
                </div>
                
                <div class="col-md-4 text-center">
                    <button class="btn clear-data-btn btn-lg" onclick="clearAllData()" id="clearDataBtn">
                        <i class="bi bi-trash"></i> 清空所有数据
                    </button>
                    <small class="text-muted d-block mt-2">点击后需要二次确认</small>
                </div>
            </div>
            
            <div class="mt-3">
                <h6>清空进度</h6>
                <div id="clearDataProgress" style="display: none;">
                    <div class="progress-indicator">
                        <div class="progress-bar" id="clearDataProgressBar" style="width: 0%"></div>
                    </div>
                    <p class="mt-2" id="clearDataStatusText">准备清空...</p>
                </div>
                
                <div id="clearDataOverview" class="mt-3">
                    <span class="badge bg-secondary">等待清空</span>
                </div>
            </div>
        </div>

        <!-- 第二步：特征工程 -->
        <div class="module-section" id="featureModule">
            <h3><i class="bi bi-gear text-success"></i> 第二步：特征工程</h3>
            <p class="text-muted">基于清洗后的价格数据，构建技术指标特征，为机器学习模型提供输入</p>
            
            <div class="alert alert-success">
                <h6><i class="bi bi-lightbulb"></i> 特征工程说明：</h6>
                <ul class="mb-0">
                    <li><strong>技术指标</strong>：包括移动平均线(MA)、相对强弱指数(RSI)、MACD、布林带等</li>
                    <li><strong>价格特征</strong>：涨跌幅、价格变化率、成交量变化等</li>
                    <li><strong>标签生成</strong>：基于设定的阈值自动生成涨跌标签（如0%阈值，更真实）</li>
                    <li><strong>特征选择</strong>：支持全部特征、基础特征、高级特征三种模式</li>
                </ul>
            </div>
            
            <div class="row">
                <div class="col-md-6">
                    <h5>特征构建设置</h5>
                    <p>将基于清洗后的数据构建技术指标特征</p>
                    
                    <div class="mb-3">
                        <label class="form-label">特征类型</label>
                        <select class="form-select" id="featureType">
                            <option value="all">🔧 全部特征 (推荐)</option>
                            <option value="basic">📊 基础特征 (MA, RSI, MACD)</option>
                            <option value="advanced">🚀 高级特征 (布林带, 支撑阻力)</option>
                        </select>
                        <small class="text-muted">选择要构建的特征类型</small>
                    </div>
                    
                    <div class="mb-3">
                        <label for="labelThreshold" class="form-label">标签阈值 (%)</label>
                        <input type="number" class="form-control" id="labelThreshold" 
                               value="0.0" step="0.1" min="0.0" max="10.0">
                        <small class="text-muted">设置涨跌幅阈值，超过此值标记为上涨，支持范围：0.0-10.0%</small>
                    </div>
                    
                    <button class="btn btn-success btn-lg" onclick="buildFeatures()" id="buildFeaturesBtn">
                        <i class="bi bi-gear"></i> 构建特征
                    </button>
                    <small class="text-muted d-block mt-2">点击开始构建特征</small>
                </div>
                
                <div class="col-md-6">
                    <h5>特征构建状态</h5>
                    <div id="featureStatus">
                        <p class="text-muted">等待数据下载完成</p>
                    </div>
                    
                    <h5 class="mt-4">构建进度</h5>
                    <div id="featureProgress" style="display: none;">
                        <div class="progress-indicator">
                            <div class="progress-bar" id="featureProgressBar" style="width: 0%"></div>
                        </div>
                        <p class="mt-2" id="featureStatusText">准备构建...</p>
                    </div>
                    
                    <div id="featureOverview" class="mt-3">
                        <span class="badge bg-secondary">等待构建</span>
                    </div>
                </div>
            </div>
            
            <!-- 特征状态 -->
            <div id="featureStatusDisplay" class="mt-4">
                <h5>特征状态</h5>
                <div class="row">
                    <!-- 状态将在这里动态显示 -->
                </div>
            </div>
        </div>

        <!-- 第三步：模型训练 -->
        <div class="module-section" id="trainingModule">
            <h3><i class="bi bi-cpu text-warning"></i> 第三步：模型训练</h3>
            <p class="text-muted">使用构建好的特征数据训练机器学习模型，评估模型性能并保存</p>
            
            <div class="alert alert-warning">
                <h6><i class="bi bi-cpu"></i> 模型训练说明：</h6>
                <ul class="mb-0">
                    <li><strong>算法选择</strong>：随机森林（抗过拟合，适合初学者）、XGBoost（高性能，适合进阶）</li>
                    <li><strong>交叉验证</strong>：使用时间序列交叉验证，避免未来数据泄露</li>
                    <li><strong>模型评估</strong>：基于F1分数、准确率、召回率等指标评估模型性能</li>
                    <li><strong>模型保存</strong>：自动保存训练好的模型、特征缩放器、模型元数据</li>
                </ul>
            </div>
            
            <div class="row">
                <div class="col-md-6">
                    <h5>训练设置</h5>
                    <p>将基于特征数据训练机器学习模型</p>
                    
                    <div class="mb-3">
                        <label class="form-label">选择算法</label>
                        <select class="form-select" id="algorithmSelect">
                            <option value="random_forest">🌲 随机森林 (推荐)</option>
                            <option value="xgboost">🚀 XGBoost (高性能)</option>
                        </select>
                        <small class="text-muted">选择机器学习算法，随机森林抗过拟合，XGBoost性能优秀</small>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">交叉验证折数</label>
                        <select class="form-select" id="cvFolds">
                            <option value="3">3折 (快速)</option>
                            <option value="5" selected>5折 (推荐)</option>
                            <option value="10">10折 (精确)</option>
                        </select>
                        <small class="text-muted">选择交叉验证折数，折数越多越精确但训练时间越长</small>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">随机种子</label>
                        <input type="number" class="form-control" id="randomSeed" value="42" min="1" max="9999">
                        <small class="text-muted">设置随机种子，确保结果可重现</small>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">训练时间范围</label>
                        <div class="row">
                            <div class="col-6">
                                <input type="date" class="form-control" id="trainingStartDate" value="2021-01-01">
                                <small class="text-muted">开始日期</small>
                            </div>
                            <div class="col-6">
                                <input type="date" class="form-control" id="trainingEndDate" value="2024-12-31">
                                <small class="text-muted">结束日期</small>
                            </div>
                        </div>
                        <small class="text-muted d-block mt-2">默认使用2021-2024年数据进行训练，其中20%用于测试</small>
                    </div>
                    
                    <button class="btn btn-warning btn-lg" onclick="trainModels()" id="trainModelsBtn">
                        <i class="bi bi-cpu"></i> 开始训练
                    </button>
                    <small class="text-muted d-block mt-2">点击开始训练模型</small>
                </div>
                
                <div class="col-md-6">
                    <h5>训练状态</h5>
                    <div id="trainingStatus">
                        <p class="text-muted">等待特征构建完成</p>
                    </div>
                    
                    <h5 class="mt-4">训练进度</h5>
                    <div id="trainingProgress" style="display: none;">
                        <div class="progress-indicator">
                            <div class="progress-bar" id="trainingProgressBar" style="width: 0%"></div>
                        </div>
                        <p class="mt-2" id="trainingStatusText">准备训练...</p>
                    </div>
                    
                    <div id="trainingOverview" class="mt-3">
                        <span class="badge bg-secondary">等待训练</span>
                    </div>
                </div>
            </div>
            
            <!-- 训练结果 -->
            <div id="trainingResults" class="mt-4" style="display: none;">
                <h5>训练结果</h5>
                <div class="row">
                    <!-- 结果将在这里动态显示 -->
                </div>
            </div>
            
            <!-- 模型状态 -->
            <div id="modelStatus" class="mt-4" style="display: none;">
                <h5>模型状态详情</h5>
                <div class="row">
                    <!-- 模型状态将在这里动态显示 -->
                </div>
            </div>
        </div>





        <!-- 第四步：未来预测 -->
        <div class="module-section" id="futureModule">
            <h3><i class="bi bi-lightning text-danger"></i> 第四步：未来预测</h3>
            <p class="text-muted">基于训练好的模型，直接预测未来5天的股票涨跌情况，生成交易信号</p>
            
            <div class="alert alert-info">
                <h6><i class="bi bi-lightning"></i> 未来预测说明：</h6>
                <ul class="mb-0">
                    <li><strong>预测范围</strong>：自动预测未来5个交易日的涨跌情况</li>
                    <li><strong>预测依据</strong>：基于最新技术指标特征和训练好的机器学习模型</li>
                    <li><strong>信号生成</strong>：根据预测概率自动生成买入、卖出或观望信号</li>
                    <li><strong>置信度</strong>：显示每个预测的置信度，帮助判断信号可靠性</li>
                    <li><strong>结果保存</strong>：自动保存预测结果，支持后续分析</li>
                </ul>
            </div>
            
            <div class="row">
                <div class="col-md-6">
                    <h5>未来预测设置</h5>
                    <p>将基于最新特征预测未来1-5天的涨跌</p>
                    
                    <div class="mb-3">
                        <label class="form-label">股票代码</label>
                        <select class="form-select" id="futureStockCode">
                            <option value="sz.002850" selected>sz.002850 (推荐 - 已有完整数据)</option>
                            <option value="sh.600000">sh.600000 (浦发银行 - 已有完整数据)</option>
                        </select>
                        <small class="text-muted">选择可预测的股票，系统自动识别交易所</small>
                        <div id="stockStatusInfo" class="mt-2">
                            <span class="badge bg-success">✅ 可预测</span>
                            <small class="text-muted ms-2">此股票已完成特征工程和模型训练</small>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">预测天数</label>
                        <select class="form-select" id="predictionDays">
                            <option value="2" selected>2天（推荐）</option>
                            <option value="3">3天</option>
                            <option value="4">4天</option>
                            <option value="5">5天（最大）</option>
                        </select>
                        <small class="text-muted">选择要预测的未来交易日数量，建议2-3天</small>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">置信度阈值</label>
                        <input type="number" class="form-control" id="confidenceThreshold" value="0.6" step="0.05" min="0.5" max="0.9">
                        <small class="text-muted">设置预测置信度阈值，建议0.6-0.7</small>
                    </div>
                    
                    <button class="btn btn-danger btn-lg" onclick="runFuturePrediction()" id="runFutureBtn">
                        <i class="bi bi-lightning"></i> 开始未来预测
                    </button>
                    <small class="text-muted d-block mt-2">点击开始未来预测</small>
                </div>
                
                <div class="col-md-6">
                    <h5>未来预测状态</h5>
                    <div id="futureStatus">
                        <p class="text-muted">等待模型训练完成</p>
                    </div>
                    
                    <h5 class="mt-4">预测进度</h5>
                    <div id="futureProgress" style="display: none;">
                        <div class="progress-indicator">
                            <div class="progress-bar" id="futureProgressBar" style="width: 0%"></div>
                        </div>
                        <p class="mt-2" id="futureStatusText">准备预测...</p>
                    </div>
                    
                    <div id="futureOverview" class="mt-3">
                        <span class="badge bg-secondary">等待预测</span>
                    </div>
                </div>
            </div>
            
            <!-- 未来预测结果 -->
            <div id="futureResults" class="mt-4" style="display: none;">
                <h5>未来预测结果</h5>
                <div class="row">
                    <!-- 结果将在这里动态显示 -->
                </div>
            </div>
        </div>
        
        <!-- 系统说明区域 -->
        <div class="row mt-5">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-light">
                        <h4><i class="bi bi-question-circle text-primary"></i> 系统使用说明</h4>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h6><i class="bi bi-1-circle text-primary"></i> 使用流程</h6>
                                <ol class="mb-3">
                                    <li><strong>数据获取</strong>：输入股票代码，系统自动识别交易所并下载数据</li>
                                    <li><strong>特征工程</strong>：基于价格数据构建技术指标特征</li>
                                    <li><strong>模型训练</strong>：使用历史数据训练机器学习模型</li>
                                    <li><strong>未来预测</strong>：直接预测未来5天的涨跌情况</li>
                                </ol>
                            </div>
                            <div class="col-md-6">
                                <h6><i class="bi bi-2-circle text-success"></i> 重要提示</h6>
                                <ul class="mb-3">
                                    <li><strong>顺序执行</strong>：必须按步骤顺序执行，每个步骤依赖前一步骤</li>
                                    <li><strong>数据质量</strong>：确保下载足够的历史数据（建议3-5年）</li>
                                    <li><strong>模型选择</strong>：初学者建议使用随机森林，进阶用户可尝试XGBoost</li>
                                    <li><strong>阈值设置</strong>：ML信号阈值建议0.51-0.53，过高会导致无交易</li>
                                    <li><strong>风险控制</strong>：所有预测结果仅供参考，请理性投资</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="row mt-3">
                            <div class="col-12">
                                <h6><i class="bi bi-3-circle text-warning"></i> 技术指标说明</h6>
                                <div class="row">
                                    <div class="col-md-4">
                                        <strong>趋势指标</strong>：MA（移动平均线）、EMA（指数移动平均线）
                                    </div>
                                    <div class="col-md-4">
                                        <strong>震荡指标</strong>：RSI（相对强弱指数）、MACD（指数平滑移动平均线）
                                    </div>
                                    <div class="col-md-4">
                                        <strong>波动指标</strong>：布林带、ATR（真实波幅）
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mt-3">
                            <div class="col-12">
                                <h6><i class="bi bi-4-circle text-info"></i> 回测指标解释</h6>
                                <div class="row">
                                    <div class="col-md-3">
                                        <strong>总收益率</strong>：策略在整个回测期间的累计收益
                                    </div>
                                    <div class="col-md-3">
                                        <strong>夏普比率</strong>：风险调整后的收益指标，越高越好
                                    </div>
                                    <div class="col-md-3">
                                        <strong>最大回撤</strong>：策略从峰值到谷值的最大跌幅
                                    </div>
                                    <div class="col-md-3">
                                        <strong>胜率</strong>：盈利交易次数占总交易次数的比例
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- 引入外部JavaScript文件 -->
    <script src="/static/js/app.js"></script>
</body>
</html>
